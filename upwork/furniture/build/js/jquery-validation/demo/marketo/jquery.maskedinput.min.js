!function(a){var v,e,t,k=(e=document.createElement("input"),t="onpaste",e.setAttribute(t,""),("function"==typeof e[t]?"paste":"input")+".mask"),n=navigator.userAgent,b=/iphone/i.test(n),y=/android/i.test(n);a.mask={definitions:{9:"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"},dataName:"rawMaskFn",placeholder:"_"},a.fn.extend({caret:function(e,t){var n;if(0!==this.length&&!this.is(":hidden"))return"number"==typeof e?(t="number"==typeof t?t:e,this.each(function(){this.setSelectionRange?this.setSelectionRange(e,t):this.createTextRange&&((n=this.createTextRange()).collapse(!0),n.moveEnd("character",t),n.moveStart("character",e),n.select())})):(this[0].setSelectionRange?(e=this[0].selectionStart,t=this[0].selectionEnd):document.selection&&document.selection.createRange&&(n=document.selection.createRange(),e=0-n.duplicate().moveStart("character",-1e5),t=e+n.text.length),{begin:e,end:t})},unmask:function(){return this.trigger("unmask")},mask:function(t,h){var n,d,m,p,g;return!t&&0<this.length?a(this[0]).data(a.mask.dataName)():(h=a.extend({placeholder:a.mask.placeholder,completed:null},h),n=a.mask.definitions,d=[],m=g=t.length,p=null,a.each(t.split(""),function(e,t){"?"==t?(g--,m=e):n[t]?(d.push(new RegExp(n[t])),null===p&&(p=d.length-1)):d.push(null)}),this.trigger("unmask").each(function(){var i=a(this),o=a.map(t.split(""),function(e,t){if("?"!=e)return n[e]?h.placeholder:e}),r=i.val();function c(e){for(;++e<g&&!d[e];);return e}function l(e,t){var n,a;if(!(e<0)){for(n=e,a=c(t);n<g;n++)if(d[n]){if(!(a<g&&d[n].test(o[a])))break;o[n]=o[a],o[a]=h.placeholder,a=c(a)}u(),i.caret(Math.max(p,e))}}function s(e,t){for(var n=e;n<t&&n<g;n++)d[n]&&(o[n]=h.placeholder)}function u(){i.val(o.join(""))}function f(e){var t,n=i.val(),a=-1,r=0;for(pos=0;r<g;r++)if(d[r]){for(o[r]=h.placeholder;pos++<n.length;)if(t=n.charAt(pos-1),d[r].test(t)){o[r]=t,a=r;break}if(pos>n.length)break}else o[r]===n.charAt(pos)&&r!==m&&(pos++,a=r);return e?u():a+1<m?(i.val(""),s(0,g)):(u(),i.val(i.val().substring(0,a+1))),m?r:p}i.data(a.mask.dataName,function(){return a.map(o,function(e,t){return d[t]&&e!=h.placeholder?e:null}).join("")}),i.attr("readonly")||i.one("unmask",function(){i.unbind(".mask").removeData(a.mask.dataName)}).bind("focus.mask",function(){var e;clearTimeout(v),r=i.val(),e=f(),v=setTimeout(function(){u(),e==t.length?i.caret(0,e):i.caret(e)},10)}).bind("blur.mask",function(){f(),i.val()!=r&&i.change()}).bind("keydown.mask",function(e){var t,n,a=e.which;8===a||46===a||b&&127===a?(t=(n=i.caret()).begin,(n=n.end)-t==0&&(t=46!==a?function(e){for(;0<=--e&&!d[e];);return e}(t):n=c(t-1),n=46===a?c(n):n),s(t,n),l(t,n-1),e.preventDefault()):27==a&&(i.val(r),i.caret(0,f()),e.preventDefault())}).bind("keypress.mask",function(e){var t=e.which,n=i.caret();e.ctrlKey||e.altKey||e.metaKey||t<32||t&&(n.end-n.begin!=0&&(s(n.begin,n.end),l(n.begin,n.end-1)),(n=c(n.begin-1))<g&&(t=String.fromCharCode(t),d[n].test(t)&&(function(e){for(var t,n,a=e,r=h.placeholder;a<g;a++)if(d[a]){if(t=c(a),n=o[a],o[a]=r,!(t<g&&d[t].test(n)))break;r=n}}(n),o[n]=t,u(),n=c(n),y?setTimeout(a.proxy(a.fn.caret,i,n),0):i.caret(n),h.completed&&g<=n&&h.completed.call(i))),e.preventDefault())}).bind(k,function(){setTimeout(function(){var e=f(!0);i.caret(e),h.completed&&e==i.val().length&&h.completed.call(i)},0)}),f()}))}})}(jQuery);